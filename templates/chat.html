{% extends "base.html" %}

{% block title %}Chat - AI Farming Assistant{% endblock %}

{% block head %}
<style>
    .chat-container {
        height: 70vh;
        display: flex;
        flex-direction: column;
    }
    
    .chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        background-color: #f8f9fa;
        border-radius: 15px;
    }
    
    .message {
        margin-bottom: 15px;
        display: flex;
        align-items: flex-start;
    }
    
    .message.user {
        justify-content: flex-end;
    }
    
    .message.assistant {
        justify-content: flex-start;
    }
    
    .message-content {
        max-width: 70%;
        padding: 12px 16px;
        border-radius: 20px;
        word-wrap: break-word;
    }
    
    .message.user .message-content {
        background-color: #28a745;
        color: white;
        border-bottom-right-radius: 5px;
    }
    
    .message.assistant .message-content {
        background-color: white;
        color: #333;
        border: 1px solid #dee2e6;
        border-bottom-left-radius: 5px;
    }
    
    .message-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 10px;
        font-size: 18px;
    }
    
    .message.user .message-avatar {
        background-color: #28a745;
        color: white;
        order: 1;
    }
    
    .message.assistant .message-avatar {
        background-color: #007bff;
        color: white;
    }
    
    .chat-input {
        border-top: 1px solid #dee2e6;
        padding: 20px;
        background-color: white;
    }
    
    .typing-indicator {
        display: none;
        padding: 10px;
        font-style: italic;
        color: #6c757d;
    }
    
    .quick-actions {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        flex-wrap: wrap;
    }
    
    .quick-action-btn {
        padding: 8px 16px;
        border: 1px solid #28a745;
        background-color: transparent;
        color: #28a745;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .quick-action-btn:hover {
        background-color: #28a745;
        color: white;
    }
    
    .sidebar {
        background-color: #f8f9fa;
        border-right: 1px solid #dee2e6;
        height: 100vh;
        overflow-y: auto;
    }
    
    .session-item {
        padding: 12px;
        border-bottom: 1px solid #dee2e6;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }
    
    .session-item:hover {
        background-color: #e9ecef;
    }
    
    .session-item.active {
        background-color: #28a745;
        color: white;
    }
    
    @media (max-width: 768px) {
        .chat-container {
            height: 60vh;
        }
        
        .message-content {
            max-width: 85%;
        }
        
        .quick-actions {
            flex-direction: column;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3 d-none d-md-block">
            <div class="sidebar p-3">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="mb-0"><i class="fas fa-comments me-2"></i>Chat Sessions</h5>
                    <button class="btn btn-sm btn-success" onclick="startNewChat()">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                
                <div id="sessionsList">
                    <!-- Sessions will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Main Chat Area -->
        <div class="col-md-9">
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">
                            <i class="fas fa-robot me-2"></i>AI Farming Assistant
                        </h4>
                        <div class="dropdown">
                            <button class="btn btn-outline-light btn-sm dropdown-toggle" type="button" id="languageDropdown" data-bs-toggle="dropdown">
                                <i class="fas fa-language me-1"></i>Language
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" onclick="changeLanguage('english')">English</a></li>
                                <li><a class="dropdown-item" href="#" onclick="changeLanguage('hindi')">‡§π‡§ø‡§Ç‡§¶‡•Ä</a></li>
                                <li><a class="dropdown-item" href="#" onclick="changeLanguage('marathi')">‡§Æ‡§∞‡§æ‡§†‡•Ä</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="card-body p-0">
                    <div class="chat-container">
                        <div class="chat-messages" id="chatMessages">
                            <!-- Welcome message -->
                            <div class="message assistant">
                                <div class="message-avatar">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <div class="message-content">
                                    <p class="mb-2"><strong>Welcome to AI Farming Assistant!</strong> üå±</p>
                                    <p class="mb-1">I'm here to help you with:</p>
                                    <ul class="mb-0">
                                        <li>üß™ Fertilizer recommendations</li>
                                        <li>üíß Watering schedules</li>
                                        <li>üêõ Pest control advice</li>
                                        <li>üåæ General farming guidance</li>
                                    </ul>
                                    <p class="mt-2 mb-0">Ask me anything about your farming needs!</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="typing-indicator" id="typingIndicator">
                            <div class="message assistant">
                                <div class="message-avatar">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <div class="message-content">
                                    <i class="fas fa-typing"></i> AI is typing...
                                </div>
                            </div>
                        </div>
                        
                        <div class="chat-input">
                            <!-- Quick Actions -->
                            <div class="quick-actions">
                                <button class="quick-action-btn" onclick="sendQuickMessage('I need fertilizer recommendations for my tomatoes')">
                                    üß™ Fertilizer Help
                                </button>
                                <button class="quick-action-btn" onclick="sendQuickMessage('What is the best watering schedule for my crops?')">
                                    üíß Watering Guide
                                </button>
                                <button class="quick-action-btn" onclick="sendQuickMessage('How can I protect my crops from pests?')">
                                    üêõ Pest Control
                                </button>
                                <button class="quick-action-btn" onclick="sendQuickMessage('What crops are best for clay soil?')">
                                    üåæ Crop Suggestions
                                </button>
                            </div>
                            
                            <!-- Message Input -->
                            <div class="input-group">
                                <textarea class="form-control" id="messageInput" placeholder="Type your farming question here..." rows="2"></textarea>
                                <button class="btn btn-success" type="button" onclick="sendMessage()">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                            
                            <div class="mt-2">
                                <small class="text-muted">
                                    <i class="fas fa-info-circle me-1"></i>
                                    You can ask questions in natural language. For example: "I grow tomatoes on clay soil, what fertilizer should I use?"
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Farm Profile Modal -->
<div class="modal fade" id="farmProfileModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-tractor me-2"></i>Farm Profile</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Add your farm details to get more personalized advice:</p>
                <form id="farmProfileForm">
                    <div class="mb-3">
                        <label class="form-label">Crop Type</label>
                        <input type="text" class="form-control" id="cropType" placeholder="e.g., Tomatoes, Wheat, Rice">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Soil Type</label>
                        <select class="form-select" id="soilType">
                            <option value="">Select soil type</option>
                            <option value="clay">Clay</option>
                            <option value="sandy">Sandy</option>
                            <option value="loamy">Loamy</option>
                            <option value="silt">Silt</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Farm Size</label>
                        <input type="text" class="form-control" id="farmSize" placeholder="e.g., 2 acres, 1 hectare">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-success" onclick="saveFarmProfile()">Save Profile</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/chat.js') }}"></script>
{% endblock %}
